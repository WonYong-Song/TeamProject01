<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="impl.AppImpl">
	<select id="acalist1" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null
			) m
	</select>
	<select id="acalist2" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and b.category=#{0}
			) m
	</select>
	<select id="acalist3" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and a.acaname like '%'||#{0}||'%'
			) m
	</select>
	<select id="acalist4" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and a.address like '%'||#{0}||'%'
			) m
	</select>
	<select id="acalist5" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and (a.address like '%'||#{0}||'%' or a.acaname like '%'||#{0}||'%')
			) m
	</select>
	<select id="acalist6" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and b.category=#{1} and a.acaname like '%'||#{0}||'%'
			) m
	</select>
	<select id="acalist7" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and b.category=#{1} and a.address like '%'||#{0}||'%'
			) m
	</select>
	<select id="acalist8" resultType="dto.MembersDTO">
		select m.*,(select avg(score) from reviewwrite where acaidx=m.idx group by m.idx) score
		from
		(
			select a.idx,a.acaname,a.address,a.detailaddress,b.category,b.acaintrophoto
			from members a inner join acaintroduce b on a.id=b.id
			where b.category is not null and b.category=#{1} and (a.address like '%'||#{0}||'%' or a.acaname like '%'||#{0}||'%')
			) m
	</select>
	
	
	<select id="detail1" resultType="dto.MembersDTO">
		select *
		from members m inner join acaIntroduce a
			on m.id = a.id
		where m.idx=#{0}
	</select>
	<select id="detail2" resultType="mybatis01.AcaTeacherDTO">
		select a.*
		from members m inner join acateacher a
		    on m.id = a.id
		where m.idx=#{0}
	</select>
</mapper>

   