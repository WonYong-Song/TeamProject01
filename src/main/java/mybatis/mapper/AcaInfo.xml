<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="impl.AcademyInfoImpl">
	<select id="AcaInfo" resultType="mybatis01.AcademyMemberDTO">
		SELECT * FROM members where IDX=#{param1}
	</select>
	
	<select id="review" resultType="mybatis01.ReviewWriteDTO"
			parameterType="mybatis01.ParamDTO">
		
		SELECT * FROM (
			SELECT Tb.*, rownum rNum FROM (
				SELECT * FROM reviewwrite 
				<choose>
					<when test="!keyString.equals('') and keyString!=null">
						WHERE ${keyField} like '%'||#{keyString}||'%' and ACAIDX=${acaidx}
				   	</when> 
				   	<otherwise>
				  		WHERE ACAIDX=${acaidx}		  			
				  	</otherwise>
			   	</choose>
				ORDER BY REVIEWIDX DESC
			) Tb
		)
		WHERE rNum BETWEEN ${start} AND ${end} 
	</select>
	<!-- 댓글 쓰기 -->
	<insert id="reviewWrite">
		insert into reviewWrite(ReviewContents,Score,Id,AcaIdx,reviewidx)
		VALUES (#{param4},#{param3}, #{param2}, #{param1},REVIEWIDX_REQ.nextval)
	</insert>
	<!-- 댓글 총갯수 찾기 -->
	<select id="getTotalCountSearchReview" resultType="int" 
		parameterType="mybatis01.ParamDTO">
		SELECT COUNT(*) FROM ReviewWrite
		<choose>
			<when test="!keyString.equals('') and keyString!=null">
				WHERE ${keyField} like '%'||#{keyString}||'%' and ACAIDX=${acaidx}
		   	</when> 
		   	<otherwise>
		  		WHERE ACAIDX=${acaidx}	  			
		  	</otherwise>
	   	</choose>
	</select> 
	
	<!-- 댓글 삭제 -->
	<delete id="delete">
		DELETE FROM reviewWrite WHERE reviewidx=#{param1}
	</delete>
	<!-- 강사정보 가져오기 -->
	<select id="teacherInfo" resultType="mybatis01.AcaTeacherDTO">
		SELECT * FROM acateacher where id=#{param1}
	</select>
	<!-- 학원소개 가져오기 -->
	<select id="acaIntro" resultType="mybatis01.AcaiIntroduceDTO">
		SELECT * FROM acaintroduce where id=#{param1}
	</select>
	<!-- 강의 목록 가져오기 -->
	<select id="classIntro" resultType="mybatis01.ClassInfoDTO">
		SELECT
    A.teaname , B.*
		FROM acateacher A, acaclass B
		
		WHERE 
		    A.teaidx=B.teaidx and A.id=#{param1}
	</select>
	<!-- 수정할 댓글 정보 -->
	<select id="reviewModify" resultType="mybatis01.ReviewWriteDTO">
		SELECT * FROM reviewWrite where REVIEWIDX=#{param1}
	</select>
	<!-- 댓글 수정 처리 -->
	<update id="modifyAction" >
		update  reviewWrite
		set 
		WHERE reviewIdx = #{param1}
	</update>
</mapper>

   